<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="composite.model.Composite">
	<select id = "GetTrainerCount" resultType = "int">
		select count(*) from
		(select id, gnum, activity, purpose, intro, exp, timage, avg(rating) as rating
		from trainer join review
		on id = tid
		group by id, gnum, activity, purpose, intro, exp, timage)
		natural join  
		((select id, name from trainer natural join member)
		natural join
		(select id, gnum, gaddr1 from trainer natural join gym))
		where rating >= 0
 		<if test = "activity == '%PT%' or activity == '%필라테스%' or activity = '%요가%' and activity != '%null%'">
			and activity like #{activity}
		</if>
		<if test = "addressDo != '%null%'">
			and gaddr1 like #{addressDo}
		</if>
		<if test = "addressSiGunGu != '%null%'">
			and gaddr1 like #{addressSiGunGu}
		</if>
		<if test = "purposeA != '%null%'">
			and purpose like #{purposeA}
		</if>
		<if test = "purposeB != '%null%'">
			and purpose like #{purposeB}
		</if>
		<if test = "purposeC != '%null%'">
			and purpose like #{purposeC}
		</if>
		<if test = "purposeD != '%null%'">
			and purpose like #{purposeD}
		</if>
    	</select>
	<select id = "GetTrainerList" resultType = "composite.model.TrainerListBean">
		select * from
		(select id, gnum, activity, purpose, intro, exp, timage, avg(rating) as rating
		from trainer join review
		on id = tid
		group by id, gnum, activity, purpose, intro, exp, timage
		<if test = "ordering == 'review'">
		order by rating desc
		</if>
		) 
		natural join  
		((select id, name from trainer natural join member)
		natural join
		(select id, gnum, gaddr1 from trainer natural join gym))
		where rating >= 0
 		<if test = "activity == '%PT%' or activity == '%필라테스%' or activity = '%요가%' and activity != '%null%'">
			and activity like #{activity}
		</if>
		<if test = "addressDo != '%null%'">
			and gaddr1 like #{addressDo}
		</if>
		<if test = "addressSiGunGu != '%null%'">
			and gaddr1 like #{addressSiGunGu}
		</if>
		<if test = "purposeA != '%null%'">
			and purpose like #{purposeA}
		</if>
		<if test = "purposeB != '%null%'">
			and purpose like #{purposeB}
		</if>
		<if test = "purposeC != '%null%'">
			and purpose like #{purposeC}
		</if>
		<if test = "purposeD != '%null%'">
			and purpose like #{purposeD}
		</if>
	</select>
</mapper>