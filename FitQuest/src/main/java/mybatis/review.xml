<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="review.model.Review">
	<select id = "GetReviewByTid" resultType = "review.model.ReviewBean">
	select * from review
	where tid = #{id}
	</select>
	<select id = "GetAverageReview" resultType = "double">
	select avg(rating) from review
	where tid = #{id}
	</select>
	<select id = "GetHasReviewById" resultType = "String">
		select distinct hasReview from review
		where tid = #{id}	
	</select>
	<insert id = "InsertBaseValue">
		insert into review(renum, mid, tid, hasReview) values(rvseq.nextval, 'admin', #{id}, 'N')
	</insert>
	<select id = "GetReviewCount" resultType = "int">
		select count(*)
		from review
		where tid = #{tid}
		<if test = "whatColumn == 'tname'">
			and mid in (select id from member where name like #{keyword})
		</if>
		<if test = "whatColumn == 'rtitle'">
			and rtitle like #{keyword}
		</if>
	</select>
	<select id = "GetReviewList" resultType = "review.model.ReviewBean">
		select *
		from review
		where tid = #{tid}
		<if test = "whatColumn == 'tname'">
			and mid in (select id from member where name like #{keyword})
		</if>
		<if test = "whatColumn == 'rtitle'">
			and rtitle like #{keyword}
		</if>
		<if test = 'ordering == "1"'>
		</if>
		<if test = 'ordering == "2"'>
			order by rating desc
		</if>
		<if test = 'ordering == "3"'>
			order by rating asc
		</if>
		<if test = 'ordering == "4"'>
			order by rdate desc
		</if>
	</select>
	<select id = "GetReviewByRenum" resultType = "review.model.ReviewBean">
		select * from review
		where renum = #{renum}
	</select>
	<update id = "InsertReport">
		update review set report = 'Y'
		where renum = #{renum}
	</update>
</mapper>